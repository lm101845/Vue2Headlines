# 课程介绍

随着智能手机的普及，人们更加习惯于通过手机来看新闻。由于生活节奏的加快，很多人只能利用碎片时间来获取信息，因此，对于移动资讯客户端的需求也越来越高。黑马头条项目正是在这样背景下开发出来。本项目主要着手于获取最新最热新闻资讯，通过大数据分析用户喜好精确推送咨询新闻。

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604846715241-ec3e2b4e-1714-4342-abf4-42029cd33bb6.png)

## 项目概述

做什么？

```
开发一个类似于手机今日头条、网易新闻的移动端新闻资讯类移动应用。
```

有哪些业务？

```
本项目涵盖了新闻资讯类 App 的重点核心功能，其中包括：用户登录 / 注册、文章列表、文章详情、文章评论、个人资料、用户中心、频道管理、文章搜索、用户收藏 / 历史 / 作品，以及机器人聊天等功能。
```

用的什么技术栈？

```
本项目采用完全前后端分离的开发模式，使用 Vue.js 技术栈（全家桶）构建的移动端 SPA 单页面应用程序。
```

本项目是 Vue.js 框架课程的**进阶项目**，项目选用目前国内最流行的前端框架：Vue.js，课程总天数：10 天，业务模块：11 个，后台接口：50+，本项目是我们**就业支撑的重要课程之一**，适合有 Vue 或 MVVM 框架使用经验的同学学习。

## 案例演示

- 演示地址：<http://toutiao.m.lipengzhou.com/>

- 测试账号：

- - 用户名：`13911111111`

- - 密码：`246810`

## 业务功能

本项目的目标是完成一个新闻资讯类 App 的核心功能，但项目中所覆盖的核心业务却非常具有普适性，在众多 App 中都有体现，诸如：

- 基于 Token 的验证方案处理用户登录

- 移动端表单验证方案及交互提示

- 短信验证码的发送与验证

- 用户中心、个人资料展示

- 对文章内容的收藏、点赞和分享

- 编辑用户资料，其中包括基本信息修改及头像裁切上传等功能

- 列表类页面的加载、缓存及优化

- 列表类页面的下拉刷新和上拉加载更多

- 资讯类文章详情展示和文章评论

- 完整的搜索业务：输入联想建议、搜索关键词高亮、搜索历史记录、搜索结果列表等

- 即时通信核心业务及基于 WebSocket 的数据通信

经过实战级项目的学习与训练之后，相信无论是在面试还是实际工作，当你遇到以上业务的开发需求时，都能信心满满从容应对。

## 技术栈

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604846911517-563973da-8b8e-47a8-9795-48e3f93b7d0e.png)

本项目采用了以下项技术解决方案：

* 基于 Vue.js 的前端框架
* 基于 webpack 工程化开发解决方案
* 基于 Vant 的前端 UI 组件库，开发效率更高
* 基于 axios 的请求库，功能强大性能高效
* 基于 RESTful 风格的数据 API 解决方案（90% 的后端均采用这种风格提供数据 API，全栈级能力，升职加薪不在话下）
* 基于 JWT 的 Token 状态维持解决方案（能够让你强化更多服务器知识）
* 基于 Vue Router 的路由管理方案
* 基于 Vuex 的状态共享方案
* 基于 Vue CLI 的脚手架工具，快速创建项目快速开发
* 基于 Socket.IO 的实时通信解决方案
* 基于 PostCSS 的移动端 REM 适配解决方案
* 基于 DCloud 平台的移动 App 开发解决方案

以上技术能力是时下一线企业对每一位前端工程师的基准要求。不过由于前端技术的演化速度太快，现在仍有一些一线的前端工程师处在自学和探索阶段，自己找寻着这些技术的使用场景及最佳实践。

而我们的课程则是以项目的核心业务需求为驱动，以技术解决方案为支撑，不仅能让你在短时间内学会这些技术的使用，还能够应用这些技术解决一个有一个真实的企业级业务需求，为你的技能成长做好铺垫，也为你的求职就业助力。

# 项目初始化

## 使用 Vue CLI 创建项目

如果你还没有安装 VueCLI，请执行下面的命令安装或是升级：

```
npm install --global @vue/cli
```

在命令行中输入以下命令创建 Vue 项目：

```
vue create toutiao-m
```

```
Vue CLI v4.3.1
? Please pick a preset:
  default (babel, eslint)
> Manually select features
```

default：默认勾选 babel、eslint，回车之后直接进入装包

manually：自定义勾选特性配置，选择完毕之后，才会进入装包

选择第 2 种：手动选择特性，支持更多自定义选项

```
? Please pick a preset: Manually select features
? Check the features needed for your project:
 (*) Babel
 ( ) TypeScript
 ( ) Progressive Web App (PWA) Support
 (*) Router
 (*) Vuex
 (*) CSS Pre-processors
>(*) Linter / Formatter
 ( ) Unit Testing
 ( ) E2E Testing
```

分别选择：

- Babel：es6 转 es5

- Router：路由

- Vuex：数据容器，存储共享数据

- CSS Pre-processors：CSS 预处理器，后面会提示你选择 less、sass、stylus 等

- Linter / Formatter：代码格式校验

```
? Use history mode for router? (Requires proper server setup for index fallback in production) (Y/n) n
```

是否使用 history 路由模式，这种模式兼容不好，所以这里输入 `n` 不使用

```
? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default):
  Sass/SCSS (with dart-sass)
  Sass/SCSS (with node-sass)
> Less
  Stylus
```



选择 CSS 预处理器，这里选择我们熟悉的 Less

```
? Pick a linter / formatter config:
  ESLint with error prevention only
  ESLint + Airbnb config
> ESLint + Standard config
  ESLint + Prettier
```

选择校验工具，这里选择 ESLint + [Standard config](https://standardjs.com/)

```
? Pick additional lint features:
 (*) Lint on save
>(*) Lint and fix on commit
```

选择在什么时机下触发代码格式校验：

- Lint on save：每当保存文件的时候

- Lint and fix on commit：每当执行 `git commit` 提交的时候

这里建议两个都选上，更严谨。

```
? Where do you prefer placing config for Babel, ESLint, etc.? (Use arrow keys)
> In dedicated config files
  In package.json
```

Babel、ESLint 等工具会有一些额外的配置文件，这里的意思是问你将这些工具相关的配置文件写到哪里：

- In dedicated config files：分别保存到单独的配置文件

- In package.json：保存到 package.json 文件中

这里建议选择第 1 个，保存到单独的配置文件，这样方便我们做自定义配置。

```
? Save this as a preset for future projects? (y/N) N
```

这里里是问你是否需要将刚才选择的一系列配置保存起来，然后它可以帮你记住上面的一系列选择，以便下次直接重用。

这里根据自己需要输入 y 或者 n，我这里输入 n 不需要。

```
✨  Creating project in C:\Users\LPZ\Desktop\topline-m\.
�  Initializing git repository...
⚙  Installing CLI plugins. This might take a while...

[          ........] - extract:object-keys: sill extract json5@2.1.1
```

向导配置结束，开始装包。
安装包的时间可能较长，请耐心等待......

```
⚓  Running completion hooks...
�  Generating README.md...
�  Successfully created project topline-m-89.
�  Get started with the following commands:
 $ cd topline-m
 $ npm run serve
```

安装结束，命令提示你项目创建成功，按照命令行的提示在终端中分别输入：

```
# 进入你的项目目录
cd toutiao-m

# 启动开发服务
npm run serve
```

```
 DONE  Compiled successfully in 7527ms
  App running at:
  - Local:   http://localhost:8080/
  - Network: http://192.168.10.216:8080/

  Note that the development build is not optimized.
  To create a production build, run npm run build.
```

启动成功，命令行中输出项目的 http 访问地址。
打开浏览器，输入其中任何一个地址进行访问。

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604846992170-ee98ea34-a693-4bfb-9400-3f093b9e3972.png)



如果能看到该页面，恭喜你，项目创建成功了。

## 初始目录结构介绍

项目创建好以后，下面我们来了解一下初始目录结构的含义：

```
.
├── node_modules              第三方包存储目录
├── public                    任何放置在 public 文件夹的静态资源都会被简单的复制，而不经过 webpack。
│   ├── favicon.ico           浏览器收藏夹图标
│   └── index.html            单页面 HTML 文件
├── src
│   ├── assets                公共资源目录，放图片等资源
│   ├── components            公共组件目录
│   ├── router                Vue Router 路由模块
│   ├── store                 Vue 容器模块
│   ├── views                 视图组件存储目录，所有的路由页面都存储到这里
│   ├── App.vue               根组件，最终被替换渲染到 index.html 页面中 #app 入口节点
│   └── main.js               整个项目的启动入口模块
├── .browserslistrc           指定了项目的目标浏览器的范围。这个值会被 @babel/preset-env 和 Autoprefixer 用来确定需要转译的 JavaScript 特性和需要添加的 CSS 浏览器前缀
├── .editorconfig             EditorConfig 帮助开发人员定义和维护跨编辑器（或IDE）的统一的代码风格，详情参考这里：https://editorconfig.org/。
├── .eslintrc.js              ESLint 的配置文件
├── .gitignore                Git 的忽略配置文件，告诉Git项目中要忽略的文件或文件夹
├── README.md                 说明文档
├── babel.config.js           Babel 的配置文件
├── package-lock.json         记录安装时的包的版本号，以保证自己或其他人在 npm install 时大家的依赖能保证一致
└── package.json              包说明文件，记录了项目中使用到的第三方包依赖信息等内容
```

## 加入 Git 版本管理

几个好处：

- 代码备份

- 多人协作

- 历史记录

- ...

（1）创建远程仓库

- [GitHub](https://github.com/lipengzhou)

- [码云](https://gitee.com/)

- [Coding](https://coding.net/)

- ...

（2）将本地仓库推到线上

如果没有本地仓库。

```
# 创建本地仓库
git init

# 将文件添加到暂存区
git add 文件

# 提交历史记录
git commit "提交日志"

# 添加远端仓库地址
git remote add origin 你的远程仓库地址

# 推送提交
git push -u origin master
```

如果已有本地仓库（Vue CLI 已经帮我们初始化好了）。

```
# 添加远端仓库地址
git remote add origin 你的远程仓库地址

# 推送提交
git push -u origin master
```

如果之后项目代码有了变动需要提交：

```
git add 文件
git commit -m "提交日志"
git push

# 如果修改了提交信息，则重新
git push -u 远程仓库 分支信息
```

## 调整初始目录结构

默认生成的目录结构不满足我们的开发需求，所以需要做一些自定义改动。

这里主要处理下面的内容：

- 删除初始化的默认文件

- 新增调整我们需要的目录结构

修改 `App.vue`：

```
<template>
  <div id="app">
    <h1>黑马头条</h1>
    <!-- 路由的出口 -->
    <router-view/>
  </div>
</template>

<script>
export default {
  name: 'App'
}
</script>

<style lang="less"></style>
```

修改 `router/index.js`：

```
import Vue from 'vue'
import VueRouter from 'vue-router'

Vue.use(VueRouter)

const routes = [
]

const router = new VueRouter({
  routes
})

export default router
```

删除默认示例文件：

- src/views/About.vue

- src/views/Home.vue

- src/components/HelloWorld.vue

- src/assets/logo.png

创建以下内容：

- src/api 目录，存储接口封装
- src/utils 目录，存储一些工具模块
- src/styles 目录，存储样式资源
  - index.less 文件，存储全局样式
- 在 `main.js` 中加载全局样式 `import './styles/index.less'`

调整之后的目录结构如下。

```
.                      
├── public             
│   ├── favicon.ico    
│   └── index.html     
├── src                
│   ├── api            存储 API 请求模块
│   ├── router         Vue Router 路由模块
│   ├── store          Vuex 容器模块
│   ├── styles         存储全局样式资源目录
│   ├── utils          存储工具模块
│   ├── views          存储视图组件
│   ├── App.vue        根组件
│   └── main.js        入口模块
├── .browserslistrc    
├── .editorconfig      
├── .eslintrc.js       
├── .gitignore         
├── README.md          
├── babel.config.js    
├── package-lock.json  
└── package.json
```

## 关于移动端组件库

下面是 [Awesome Vue](https://github.com/vuejs/awesome-vue#mobile) 收集的一些优质的第三方组件库资源。

*UI frameworks for mobile*

- [Framework7-Vue](https://github.com/framework7io/framework7) - Build full featured iOS & Android apps using Framework7 & Vue.

- [vux](https://github.com/airyland/vux) - [Chinese] Vue UI Components based on WeUI.

- [vue-onsenui](https://github.com/OnsenUI/OnsenUI) - Mobile app development framework and SDK using HTML5 and JavaScript. Create beautiful and performant cross-platform mobile apps. Based on Web Components, and provides bindings for Angular 1, 2, React and Vue.js.

- [Weex](https://weex.incubator.apache.org/) - Weex provides the ability to publish cross platform, so web, Android, and IOS apps can use the same API development functions.

- [weex-eros](https://github.com/bmfe/eros-template) - [Chinese] Eros is a app solution based on Weex and Vue, which enables you to use API of Vue, simple and quick development of small and medium app.

*Set of components for mobile*

- [mint-ui](https://github.com/ElemeFE/mint-ui) - Mobile UI elements for Vue.js.

- [vant](https://github.com/youzan/vant) - A Vue.js 2.0 Mobile UI From YouZan.

- [cube-ui](https://didi.github.io/cube-ui) - A fantastic mobile ui lib implement by Vue.js 2.

- [mand-mobile](https://didi.github.io/mand-mobile) - A mobile UI toolkit, based on Vue.js 2, designed for financial scenes.

- [NutUI](https://github.com/jdf2e/nutui/) - A Vue.js 2.0 UI Toolkit for Mobile Web

## 导入 Vant 组件库

Vant 是有赞商城前端开发团队开发的一个基于 Vue.js 的移动端组件库，它提供了非常丰富的移动端功能组件，简单易用。

- [官方文档](https://youzan.github.io/vant/#/zh-CN/)

- [GitHub 仓库](https://github.com/youzan/vant)

下面是在 Vant 官网中列出的一些优点：

- 60+ 高质量组件

- 90% 单元测试覆盖率

- 完善的中英文文档和示例

- 支持按需引入

- 支持主题定制

- 支持国际化

- 支持 TS

- 支持 SSR

在我们的项目中主要使用 Vant 作为核心组件库，下面我们根据[官方文档](https://youzan.github.io/vant/#/zh-CN/quickstart#yin-ru-zu-jian)将 Vant 导入项目中。

将 Vant 引入项目一共有四种方式：

- 方式一：自动按需引入组件

- - 和方式二一样，都是按需引入，但是加载更方便一些（需要额外配置插件）

- - 优点：打包体积小

- - 缺点：每个组件在使用之前都需要手动加载注册

- 方式二：手动按需引入组件

- - 在不使用插件的情况下，可以手动引入需要的组件

- - 优点：打包体积小

- - 缺点：每个组件在使用之前都需要手动加载注册

- 方式三：导入所有组件

- - Vant 支持一次性导入所有组件，引入所有组件会增加代码包体积，因此不推荐这种做法

- - 优点：导入一次，使用所有

- - 缺点：打包体积大

- 方式四：通过 CDN 引入

- - 使用 Vant 最简单的方法是直接在 html 文件中引入 CDN 链接，之后你可以通过全局变量`vant`访问到所有组件。

- - 优点：适合一些演示、示例项目，一个 html 文件就可以跑起来

- - 缺点：不适合在模块化系统中使用

这里建议为了前期开发的便利性我们选择方式三：导入所有组件，在最后做打包优化的时候根据需求配置按需加载以降低打包体积大小。

1、安装 Vant

```
npm i vant
```

2、在 `main.js` 中加载注册 Vant 组件

```
import Vue from 'vue'
import Vant from 'vant'
import 'vant/lib/index.css'

Vue.use(Vant)
```

3、查阅文档使用组件

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604847043854-eabf0b88-7fbc-490c-9c26-4f646510913e.png)

Vant 的文档非常清晰，左侧是组件目录导航，中间是效果代码，右边是效果预览。

例如我们在根组件使用 Vant 中的组件：

```
<van-button type="default">默认按钮</van-button>
<van-button type="primary">主要按钮</van-button>
<van-button type="info">信息按钮</van-button>
<van-button type="warning">警告按钮</van-button>
<van-button type="danger">危险按钮</van-button>

<van-cell-group>
  <van-cell title="单元格" value="内容" />
  <van-cell title="单元格" value="内容" label="描述信息" />
</van-cell-group>
```

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604847109753-a3f7ed09-76d1-4450-9f71-64a9d374b016.png)

如果在页面中能够正常的看到下面的效果，则说明 Vant 导入成功了。

## 移动端 REM 适配

Vant 中的样式默认使用 `px` 作为单位，如果需要使用 `rem` 单位，推荐使用以下两个工具：

- [postcss-pxtorem](https://github.com/cuth/postcss-pxtorem) 是一款 postcss 插件，用于将 px 单位转化为 rem

- [lib-flexible](https://github.com/amfe/lib-flexible) 用于设置 rem 基准值

下面我们分别将这两个工具配置到项目中完成 REM 适配。

**（1）使用** [**lib-flexible**](https://github.com/amfe/lib-flexible) **动态设置 REM 基准值（html 标签的字体大小）**

安装依赖：

```
# yarn add amfe-flexible
npm i amfe-flexible
```

然后在 `main.js` 中加载执行该模块：

```
import 'amfe-flexible'
```

最后测试：在浏览器中切换不同的手机设备尺寸，观察 html 标签 `font-size` 的变化。

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604847154728-3bdb009d-edc4-4afd-8039-5f5e4cf49336.png)

例如在 iPhone 6/7/8 设备下，html 标签字体大小为 37.5 px

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604847176486-d80e2a63-16fd-4fee-bbfc-0df64c4c7e67.png)

例如在 iPhone 6/7/8 Plus 设备下，html 标签字体大小为 41.4 px

**（2）使用** [**postcss-pxtorem**](https://github.com/cuth/postcss-pxtorem) **将** `px` **转为** `rem`

安装依赖：

```
# yarn add -D postcss-pxtorem
# -D 是 --save-dev 的简写
npm install postcss-pxtorem -D
```



然后在**项目根目录**中创建 `postcss.config.js` 文件：



```
module.exports = {
  plugins: {
    'autoprefixer': {
      browsers: ['Android >= 4.0', 'iOS >= 8']
    },
    'postcss-pxtorem': {
      rootValue: 37.5,
      propList: ['*']
    }
  }
}
```



配置完毕，**重新启动服务**。



最后测试：**刷新页面**，审查元素样式查看是否已将 `px` 转换为 `rem`。



![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604847210468-457c76b5-44ca-459c-8f75-135510f9ce73.png)

这是没有配置转换之前的。



![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604847219469-d2c7c346-f155-4cb3-adcd-356089c0937c.png)

这是转换之后的，可以看到 px 都被转换为了 rem。

**需要注意的是：**

- 该插件**不能转换行内样式中的** `px`，例如 `<div style="width: 200px;"></div>`

## 关于 PostCSS 配置文件

```
module.exports = {
  plugins: {
    'autoprefixer': {
      browsers: ['Android >= 4.0', 'iOS >= 8']
    },
    'postcss-pxtorem': {
      rootValue: 37.5,
      propList: ['*']
    }
  }
}
```

`postcss.config.js` 是 PostCSS 的配置文件。

### PostCSS 介绍

PostCSS 是一个允许使用 JS 插件转换样式的工具。 这些插件可以检查（lint）你的 CSS，支持 CSS Variables 和 Mixins， 编译尚未被浏览器广泛支持的先进的 CSS 语法，内联图片，以及其它很多优秀的功能。

PostCSS 被广泛地应用，其中不乏很多有名的行业领导者，如：维基百科，Twitter，阿里巴巴， JetBrains。PostCSS 的 [Autoprefixer](https://github.com/postcss/autoprefixer) 插件是最流行的 CSS 处理工具之一。

PostCSS 接收一个 CSS 文件并提供了一个 API 来分析、修改它的规则（通过把 CSS 规则转换成一个[抽象语法树](https://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E8%AA%9E%E6%B3%95%E6%A8%B9)的方式）。在这之后，这个 API 便可被许多[插件](https://github.com/postcss/postcss/blob/master/README-cn.md#%E6%8F%92%E4%BB%B6)利用来做有用的事情，比如寻错或自动添加 CSS vendor 前缀。

截止到目前，PostCSS 有 200 多个功能各异的插件。你可以在 [插件列表](https://github.com/postcss/postcss/blob/master/docs/plugins.md) 或 [搜索目录](http://postcss.parts/) 找到它们。

[PostCSS](https://postcss.org/) 是一个处理 CSS 的处理工具，本身功能比较单一，它主要负责解析 CSS 代码，再交由插件来进行处理，它的插件体系非常强大，所能进行的操作是多种多样的，例如：

- [Autoprefixer](https://github.com/postcss/autoprefixer) 插件可以实现自动添加浏览器相关的声明前缀

- [PostCSS Preset Env](https://github.com/csstools/postcss-preset-env) 插件可以让你使用更新的 CSS 语法特性并实现向下兼容

- [postcss-pxtorem](https://github.com/cuth/postcss-pxtorem) 可以实现将 px 转换为 rem

- ...

PostCSS 一般不单独使用，而是与已有的构建工具进行集成。

[Vue CLI 默认集成了 PostCSS](https://cli.vuejs.org/zh/guide/css.html#postcss)，并且默认开启了 [autoprefixer](https://github.com/postcss/autoprefixer) 插件。

Vue CLI 内部使用了 PostCSS。

你可以通过 `.postcssrc` 或任何 [postcss-load-config](https://github.com/michael-ciniawsky/postcss-load-config) 支持的配置源来配置 PostCSS。也可以通过 `vue.config.js` 中的 `css.loaderOptions.postcss` 配置 [postcss-loader](https://github.com/postcss/postcss-loader)。

我们默认开启了 [autoprefixer](https://github.com/postcss/autoprefixer)。如果要配置目标浏览器，可使用 `package.json` 的 [browserslist](https://cli.vuejs.org/zh/guide/browser-compatibility.html#browserslist) 字段。

### Autoprefixer 插件的配置

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604847292658-004fe619-8e9a-41f9-937f-b9913abe5cc9.png)

[autoprefixer](https://github.com/postcss/autoprefixer) 是一个自动添加浏览器前缀的 PostCss 插件，`browsers` 用来配置兼容的浏览器版本信息，但是写在这里的话会引起编译器警告。

```
Replace Autoprefixer browsers option to Browserslist config.
Use browserslist key in package.json or .browserslistrc file.

Using browsers option can cause errors. Browserslist config
can be used for Babel, Autoprefixer, postcss-normalize and other tools.

If you really need to use option, rename it to overrideBrowserslist.

Learn more at:
https://github.com/browserslist/browserslist#readme
https://twitter.com/browserslist
```

警告意思就是说你应该将 `browsers` 选项写到 `package.json` 或 `.browserlistrc` 文件中。

browserslist：

你会发现有 `package.json` 文件里的 `browserslist` 字段 (或一个单独的 `.browserslistrc` 文件)，指定了项目的目标浏览器的范围。这个值会被 [@babel/preset-env](https://new.babeljs.io/docs/en/next/babel-preset-env.html) 和 [Autoprefixer](https://github.com/postcss/autoprefixer) 用来确定需要转译的 JavaScript 特性和需要添加的 CSS 浏览器前缀。

参考[官方文档](https://github.com/browserslist/browserslist)中的语法，我们将 `.browserslistrc` 修改如下：

```
Android >= 4.0
iOS >= 8
```

### postcss-pxtorem 插件的配置

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604847305511-3739fde6-e810-4942-b056-47795fa1cf1c.png)

- `rootValue`：表示根元素字体大小，它会根据根元素大小进行单位转换

- `propList` 用来设定可以从 px 转为 rem 的属性

- - 例如 `*` 就是所有属性都要转换，`width` 就是仅转换 `width` 属性

`rootValue` 应该如何设置呢？

```
如果你使用的是基于 lib-flexable 的 REM 适配方案，则应该设置为你的设计稿的十分之一。
例如设计稿是 750 宽，则应该设置为 75。
```

大多数设计稿的原型都是以 iPhone 6 为原型，iPhone 6 设备的宽是 750，我们的设计稿也是这样。

但是 Vant 建议设置为 37.5，为什么呢？

```
因为 Vant 是基于逻辑像素 375 写的，所以如果你设置为 75 的话，Vant 的样式就小了一半。
```

所以如果设置为 `37.5` 的话，Vant 的样式是没有问题的，但是我们在测量设计稿的时候都必须除2才能使用，否则就会变得很大。

有没有更好的办法不用除以2呢？当然有了，这里给大家介绍两种方式，一种不用写代码，一种需要写代码。

**（1）不用写代码的方式**

在 Photoshop 中打开单位与标尺设置面板：菜单栏 -> 编辑 -> 首选项 -> 单位与标尺。

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604847449295-574bb078-5f03-4414-9cb4-5421d47fb8f6.png)



将单位中的标尺和文字的单位修改为`点`



打开设置图像大小面板：

- 菜单栏 -> 图像 -> 图像大小

- 快捷键：`Alt + Ctrl + I`

![img](https://cdn.nlark.com/yuque/0/2020/png/152778/1604847470901-b069db43-d365-456f-b45f-604d2e1e056c.png)

- 关闭重新采样

- 将宽度单位设置为`点`

- 将高度单位设置为`点`

- 将宽度修改为 `375`，高度不用动（它会适应宽度自动调整）

点击确定完成修改。



调整之后，我们可以看到图像的大小变成了 375 点 x 667 点（144 ppi）。



在 iPhone 6/7/8 设备下，1个点 = 2个物理像素，所以你看到我们导出的图片还是原来的二倍图。



**（2）写代码的方式（自行了解）**



通过[查阅文档](https://github.com/cuth/postcss-pxtorem#options)我们可以看到 `rootValue` 支持两种参数类型：



- 数字：固定值

- 函数：动态计算返回

- - 有一个默认参数：一个对象，其中包含一个 file 属性（编译的文件路径）



所以我们可以这样来处理它：



```
module.exports = {
  plugins: {
    'postcss-pxtorem': {
      rootValue ({ file }) {
        // 如果是 Vant 的样式就按照 37.5 处理转换
        // 如果是我们自己的样式就按照 75 处理转换
        return file.indexOf('vant') !== -1 ? 37.5 : 75
      },
      propList: ['*']
    }
  }
}
```



这种方式不方便调试。因为在调试面板中看到的都是逻辑像素大小，它和 750 物理像素设计稿不一致，无法很好的利用调试工具。



## 关于字体图标



### 使用 iconfont 制作字体图标



设计师为我们单独提供了设计稿中的图标，为了方便使用，我们在这里把它制作为字体图标。



制作字体图标的工具有很多，在这里我们推荐大家使用：https://www.iconfont.cn/。



（1）登录 iconfont

（2）创建项目

项目名称：黑马头条移动端

项目描述：可选的

FontClass/Symbol 前缀：`toutiao-`

Font Family：`toutiao`

注意：Font Class 和 FontFamily 最好符合上述规则，例如：`foo-` 和 `foo`、`abc-` 和 `abc`



（3）上传图标到项目中



![img](assets/image-20200325010119980.png)



点击上传图标至项目



![img](assets/image-20200325010201945.png)



将图标文件拖拽到页面上传或者点击上传



![img](assets/image-20200325010254398.png)



选择课程资料中所有的图标文件



![img](assets/image-20200325010413448.png)



去除颜色并提交



![img](assets/image-20200325010439802.png)



如图所示，添加完成



（4）将图标资源导入到项目中



参考官方文档的[使用帮助](https://www.iconfont.cn/help/detail?spm=a313x.7781069.1998910419.d8cf4382a&helptype=code)。



![img](assets/image-20200325010505302.png)



点击生成代码



![img](assets/image-20200509205910377.png)



复制链接中的代码



在项目中创建 `src/styles/icon.less` 并写入上面复制到的代码。



```
@font-face {font-family: "toutiao";
  src: url('//at.alicdn.com/t/font_1807762_wgyu54o0zqf.eot?t=1589027112128'); /* IE9 */
  src: url('//at.alicdn.com/t/font_1807762_wgyu54o0zqf.eot?t=1589027112128#iefix') format('embedded-opentype'), /* IE6-IE8 */
  url('data:application/x-font-woff2;charset=utf-8;base64,d09GMgABAAAAAA6cAAsAAAAAGWQAAA5PAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHEIGVgCFCAqiOJsEATYCJANUCywABCAFhGEHgWsbvRQzo/aKtHIj+68TOLk/rA4NzelemIqYKGADNS3cBGGZYhXxhGHPqFssG/nviwhGmDLdaH9NISjU45jgn28u/Psyk2wywcUSoSJUrUVUjMfXVqFmi+gY/ne8ATA9bevfslQtNvgPzMRKxEIPIwpMxAzMvij0MhIuIhn8OjinnU1taARnfeUQ1VkCJXaxY0ia/wrJAffd/qb9jW0UQnXJs3/56SmE0UeTPkg6btCuGjbJ8h5ABSs4gW3S6oTFu4IqY2bWcEfzCLKI216BhALwe7x9PUDgoPP/1lKbyXus7iLciCMX8GZnb3+y//iXJ8R7KcwGWBVJ9dXICjVT3C0HyaUudSQrXIWzlYUAc6pPalwgiQOkqA7b3G77ratDgKM9fdHUz/BYEGJRGTFtdSzIAuHGaWwmKsJCkPiodTqFT+gd9t7hZPzz+jZYIXj4BvU1c5YG5oKJHz/WzK4mW2za0c7lJFB+CgzQF7CgbcmOrZgF9o1Zl+qwTMtnLPM+1ppN8BGfrq2N38Ng8d+XWiIkwhGTkJKRU1Cmwj+8KjVQgJqQAIhFQB0+YglFgPAACANAWADCByACAKIEQIQARARAOAAiBiASACIFIDIAIgcgCgCiDEBUANL5XJUMMlejknTrPw70BjaAPwKCP1X+tMxanerhE2HGIhz+rhcQ4glM0fjd2ll1CzspUaq6qlsgq2szuRazalX176XCWacEfVHIxXFSyTVSETvLkkxts9ZKVUsTRa7i8ixRRV2ThvKiXVVrfL2cC4yrIs7/fywkY33sffXqSTr5vTlhA5C4pdbYXVc0Y5q34FwAvENnnANsy/4c33TWTQTXaW3CpKKetxjB5B3NnrT3RWxogb7p528AZHqQnrwuBqxXZAxsXAMJaXi7VFeU33jzZrbsEQIdoHazF4sGCLmc/M5QUxPdI5X7cdhHo8qE/Oq4Soviac2t7lhCMrXtpRkXO9GxGMt2ZYygrUpzvFTFYXmlS1ksGKooT1kiBamqwGWvSmUJGwlkaI3mqJkADXDEVrXDrOVWTDg85EHICczOWJqVe7z8RFVR3Cg2DJLGre4Qk3RRDne7wGmATGsXFClqaz7PmuwyuizMH1zuyH1Nv9db6ozdmTDbBJ+00V3oXIx/9Dc4s/a5UDFm1ydeqjEZL5Vvemia0IkbceXGEuHkVbFAkUB47OjytJsoiBK7CYpGZQwlCgjL4grV18NFF05qDxkvE6pL3SR1zTfu7gs9vfU5U3eD4RcPQXf6fi7MldtINKKHwk6oJMQslxk2RiXohTzNUwCwBEuaBTLbFO18A0VJPZHeQbfcWtQndjz0fsB6Z+7/fPSzN7nzzoVID1C5/KiUs5kxwBZlmWSJkVkUQT5xDKgUT5uz5HV277EnHsRdG7NMQiQmWAJaciw0VOcwUaBBtcJWQs9/17ozfwfjz37WOJPf+1K8J6297rgFYrXxOWOqK8y75RTV5wxmMYBEAxYO38bv+c3F1TD++DV/EMfDO5ETrnGl1ugPohjlPtPvZTzFlmhNX6AedrvTeX0vczMJ0Ldd4BNWDkPt3bp9LIF3KlKlBdKoQm5KBDW2p38PgKffq8sqy60O6IOK2IPIYJ8lIewOsw2qmDRgSmiXOQWJmucRFxs0ttjrbyhHnEovVn7jkMNwKCfnbIoKO2hK3LI78cDvl39kkVFN8p/2BJuwIZxdKFGa6NyqV9MrzFDKYtjnbWlyncNBkE0+4NjDch92IF9W8UQGdUiRzuPOJoYrFW/IRxWD5RWSSdA3gsc9Abm2c4fOHVj6HaN0+eTT/uiLl85abSFQR0SlyKoJb+Zsxpz4bRtzr5AJ2DRYpPJDJ5vZzFg+ZYStXyWTWerrhly+Lf7A739EeqCA4dSfzVJ1T1n6yrC7ZKxYzDplbnE+w6UpK8lvukqSKiwmFkrcUqeP0If1fvLgn4uLvHDbuMf6MBIQGVpJtIRqQvF9MUAf8hk92l4G3iL1HZKhG2a0e1kVLie7MOpDog7jKJYMlk5J5H87MugncUdDH4UEj2Q+9S/2DupTPxJpeLsuh+1BOMHE3rJ4bEtuW1cZmRvgY9hyQ/iaEYB/HIGRGA9kxRB5Ng7xAcLybkgzDRdjzeWdxdBf+jwZH+AELPyakL3cJpKG4WUguIWMBKAddl/u6mHjUOzncsL4cbX+jYCXQUn0hi+G4waVUCwq5Oqktj1kjU82JhBwxZPT0gucHsbvajennzVc2xw34pLV8RsTOQPNzOG2VTbHoqwzqKdFnjwzvQNfp4XWCPKLfP6m6j9IyCnllWiM671RSROA/+ZGv8uWl/18vztQNcR2rUYtetIbtPYHaYOQ5o4OpYXS4IvFF1mHHpwznysvURYQWT+9VybQ4AvBHTIwb0WFBuHsqipOOCdiq+nlhFVVywChQQLkAQk6XcUil85JrGAtcxPP8wUeCRwhJ7yqqoIbzVavX/cgEBxAz6aktkwCUncHWQeZdljbWKO6CyKjF1qY8Kxx1pT1FKOHU9gJAnNhibfNoM2OAetB6+0DxSEMAgHx1C51q36cPqIfu4O5g09CSIH65/3x5/aXCwQ4BOe6JEwJh1pebH4WzLborWC6mqs7bN6+59vyJzbST8aoUpFybZ2jeG2BsvnHZ+Nsm9lz3w4cx2a2uXoEs/F52LXyt3+vSd1p3Kv2o/nKsX+8z0ZGe65u361cY2Surv4Or2+0sLS4JtX9XV2/0GWNcu9Wru41/GzEw7cvU7bZA5sA/010BfRMimIT52rUXL1rvgmJA8aqrt6vVaGiqx5u3BxFklXJgMYMGJoKetLuYJPdaU+geZLy4Lj+4DsqVtFfgQWuoOaEAMrOhgRDxgpPCKCN2fa7D/kHBWkOabqI/4moCHrIBkad4D6bzbtx/wE1j/rgBcV29pJ/KmqeXKH1hTC1ariRR+q1yRv5HL6emEdS1hXJuiwdihtFh8lQ/Vj2/n9T2vvvhcoYRSfj3fD2hBl8XDaFy/2yDEEDYrQEG1gmpd94QhOQlQ9DbyjJQtrjhyPcEb8v6Cj4az1Ucx4WYmft/8NV8iukZVJ+Ja6Q6TSSKZHmYXdcZekAW63SbmRqLex8FKu+b//o6fjD6z9/Y+Dohxga308S4URV8nztAsbmPE6ufm7MngxL4/QB+OBluN8MFKUBlKRDl53bL7QMI23y4tPLe/GIXs/s8PIdJB+IwGdnP726yyEGFSspj4XOLALlZVBsPNJVTRcVPH+OEBwqZMVXFaRdohCe9CFpEWvkuvIa4uOfNbXK0M2Oi/smtCLp0KJB79vCOJoWxcLlexHW4YM5FAWhNFLpTDq1cbGJfw0qlLi/XwyJoIGjkFh1j50Ow7IL22UoXdp+0WmGctKvsyGhSCQsIpBYNHq4KY1daMolB7+JUJVfCYkGBkRQPmroBCrvIrNRQNN+B9eF62Z/5IDNZXckl9hJ3x+N+hs5RzKL0nBZQ6ChwsTPL04zEbQanxIyow/eAIoB9hdhpCHP4zC77tkjvlfMguViBoiICsV2jW7bSGeI2YfCAg4HG4XHJ3LTzXIus+u+XZoVLrAyPFBSo6lAVR+93MV4AlcfuQTWIHLPdEGvbq+70KNrGA7N2cnZuUcPoQAvOQHD0kyihZgGcJM2FdYRQpBUCRBCyXV1yVAK9OBCHIIwRRKK1BM2rXRMMuXTg0ONEaedkarIU8VjgJeYGADxIISzVqNJPBAARLCuQCXfQqAzgqh+LPvYDWlqYwWXtbasIAadeVgO1qVGLENLl9/Pd3xz8RODHfilbodxSyvu8RwZfkle4cpCzQgyku8v/3TxTb6jVxpqRVgqxfLs5ws8Y0lYkq/n3vsq4pLJyMUI5gfEEr1sV/UK5kfEAjPXZ1n93eGU0eKUyf0bZq1PRlsiH5krqhnVi7hY+/BARfMSW4AX2GbfOXmSq8ft6nZkLYg7eeLO7bFb8eCgkyv3zp1peRzB5D0Gs/Cm/VfTtviVK1ny0KCR24eyfITf3c0H+XPT0/z4OFrc4KDT3r69YQMaeHrOTCue2DmMtraluo70qv1ReuAdi9cH0gLn+onVZ88WaCo0w2wigH2OotVqtBs9+s/sUVjL2VlYaP5VH+U/wHDY6AdQR44ctWwO5gGlDmyOAAX7khEWQkmkbry+bkObhu6S3StCQYv6HwDzp6w13pEvc8Hkl74TSIfPUJhUfscWY8XPWWPc+XBGsIQ3h4db+XEmsD/vyQCu4VszhmP4T0OGogxygcvnFe5MUQSgD3XG+4C33XUjjHzKDVPascWdU2Rb8CWd3x1eB+aX3yGD5vU7JP1/YvjRk1NmUVyONbP2jsAQ71Cn4DcFssYvFXNt763qTN2+XodlnfNdVqxjVddClHt6s1k91/WW46lzNEV5HuB0DzRFT4WX9cjXK9seSxtOybyqtsxUdWG2qnfMJ2ZQLKDE2JijD1Pmx1RZi0E1HqI3u4mJjLPMq7rETNUNZquexXwavIsFZPwVcywS7itjumvJY8u3DJrBqn5T0RA680l+MAlHTd/gJen8DuFN/5BLJFRt1exc/gKEfHpImX3H7JTLNKrPM60NUiI1ZRrAcBWYp2ddu1RoZWjcPXZvGTT7VKvot5bREDrJDytJ+Juipm/wknROX2Uj9R9ysS/yYoqWiibPvrJY5ap18JfZd+8eO2Uxi0uj4rNWFpjKMVJMaRzkRMMV4QRvelLru7mq2ap1+XHqI1yHOoa6PBlZ+QpUUqhITrESpcqUq1BZFVVVU10NrjZqfJn8LS6tuy4D9Fbo4kVjH28OcN2/VH8tQaMJcp0i+iR4K4HElJnLnIYYMErlvABavSZJyum26NvgsZ0XwznHj/q+yKJP9dHjJTS8hzHJaSEL503AyiVhX4BSPNep3Q4=') format('woff2'),
  url('//at.alicdn.com/t/font_1807762_wgyu54o0zqf.woff?t=1589027112128') format('woff'),
  url('//at.alicdn.com/t/font_1807762_wgyu54o0zqf.ttf?t=1589027112128') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+ */
  url('//at.alicdn.com/t/font_1807762_wgyu54o0zqf.svg?t=1589027112128#toutiao') format('svg'); /* iOS 4.1- */
}

.toutiao {
  font-family: "toutiao" !important;
  font-size: 16px;
  font-style: normal;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.toutiao-dianzan:before {
  content: "\e600";
}

.toutiao-dianzan2:before {
  content: "\e601";
}

.toutiao-gengduo:before {
  content: "\e602";
}

.toutiao-guanbi:before {
  content: "\e603";
}

.toutiao-fenxiang:before {
  content: "\e604";
}

.toutiao-shanchu:before {
  content: "\e605";
}

.toutiao-pinglun:before {
  content: "\e606";
}

.toutiao-shoucang:before {
  content: "\e607";
}

.toutiao-shouji:before {
  content: "\e608";
}

.toutiao-shipin:before {
  content: "\e609";
}

.toutiao-wenda:before {
  content: "\e60a";
}

.toutiao-sousuo:before {
  content: "\e60b";
}

.toutiao-shouye:before {
  content: "\e60c";
}

.toutiao-yanzhengma:before {
  content: "\e60d";
}

.toutiao-wuwangluo:before {
  content: "\e60e";
}

.toutiao-zuojiantou:before {
  content: "\e60f";
}

.toutiao-wode:before {
  content: "\e610";
}

.toutiao-yuedu:before {
  content: "\e611";
}

.toutiao-youjiantou:before {
  content: "\e612";
}

.toutiao-zuopin:before {
  content: "\e613";
}

.toutiao-lishi:before {
  content: "\e614";
}
```



然后在 `src/styles/index.less` 中加载 `icon.less`。



```
/**
 * 全局样式
 */

@import "./icon.less";
```



最后就是如何使用：使用 `i` 标签，给两个类名，一个是字体类名 `toutiao`，一个是图标类名 `toutiao-xxx`。



```
<!-- 手机图标 -->
<i class="toutiao toutiao-shouji"></i>

<!-- 收藏图标 -->
<i class="toutiao toutiao-shoucang"></i>
```



### 使用 Vant 中的图标



Vant 组件库内置了一套非常精致的[字体图标](https://youzan.github.io/vant/#/zh-CN/icon)，除基本功能之外还支持徽标提示等功能。



```
<!-- 基本展示 -->
<van-icon name="chat-o" />

<!-- 设置dot属性后，会在图标右上角展示一个小红点 -->
<van-icon name="chat-o" dot />

<!-- 设置badge属性后，会在图标右上角展示相应的徽标 -->
<van-icon name="chat-o" badge="9" />
```



更多使用方式参见官方文档。



## 配置路由页面



我们这里先把这几个主要的页面配置出来，其它页面在随后的开发过程中配置。

| 路径           | 页面                   | 备注               |
| -------------- | ---------------------- | ------------------ |
| /login         | views/login/index.vue  | 登录页面           |
| /              | views/layout/index.vue | 布局组件           |
| \|--    /      | views/home/index.vue   | 首页（默认子路由） |
| \|--    /qa    | views/qa/index.vue     | 问答页面           |
| \|--    /video | views/video/index.vue  | 视频页面           |
| \|--    /my    | views/my/index.vue     | 我的页面           |



先把每个页面的基础代码写成类似于下面这样。



```
<template>
  <div class="login-container">登录页面</div>
</template>

<script>
export default {
  name: 'LoginIndex',
  components: {},
  props: {},
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less"></style>
```



`views/layout/index.vue` 布局组件：



```
<template>
  <div class="layout-container">
    <!-- 子路由出口 -->
    <router-view />
    <!-- /子路由出口 -->

    <!-- 底部导航栏 -->
    <van-tabbar v-model="active" route>
      <van-tabbar-item icon="home-o" to="/">首页</van-tabbar-item>
      <van-tabbar-item icon="comment-o" to="/qa">问答</van-tabbar-item>
      <van-tabbar-item icon="video-o" to="/video">视频</van-tabbar-item>
      <van-tabbar-item icon="manager-o" to="/my">我的</van-tabbar-item>
    </van-tabbar>
    <!-- /底部导航栏 -->
  </div>
</template>

<script>
export default {
  name: 'LayoutIndex',
  components: {},
  props: {},
  data () {
    return {
      active: 0
    }
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less"></style>
```



路由表配置：



```
import Vue from 'vue'
import VueRouter from 'vue-router'

Vue.use(VueRouter)

// 路由表
const routes = [
  {
    path: '/login',
    name: 'login',
    component: () => import('@/views/login/')
  },
  {
    path: '/',
    component: () => import('@/views/layout/'),
    children: [
      {
        path: '', // 默认子路由
        name: 'home',
        component: () => import('@/views/home/')
      },
      {
        path: '/qa',
        name: 'qa',
        component: () => import('@/views/qa/')
      },
      {
        path: '/video',
        name: 'video',
        component: () => import('@/views/video/')
      },
      {
        path: '/my',
        name: 'my',
        component: () => import('@/views/my/')
      }
    ]
  }
]

const router = new VueRouter({
  routes
})

export default router
```



最后访问测试。



## 封装请求模块



和之前项目一样，这里我们还是使用 [axios](https://github.com/axios/axios) 作为我们项目中的请求库，为了方便使用，我们把它封装为一个请求模块，在需要的时候直接加载即可。



安装 axios：

```
npm i axios
```

创建 `src/utils/request.js`：

```
/**
 * 封装 axios 请求模块
 */
import axios from "axios"

const request = axios.create({
  baseURL: "http://ttapi.research.itcast.cn/" // 基础路径
})

export default request
```

哪里使用，哪里加载：

```
import request from '@/utils/request'

request({
  method: 'xxx',
  url: 'xxx',
  ...
})
```

